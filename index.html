<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A 2D survival game">
    <meta name="author" content="mcjdh">
    <meta name="theme-color" content="#111111">
    <title>Galactic Ring Cannon</title>
    <link rel="preload" href="assets/css/styles.css" as="style">
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220%200%20100%20100%22><text y=%22.9em%22 font-size=%2290%22>üéÆ</text></svg>">
</head>

<body>
    <div id="loading-screen">
        <h1>Galactic Ring Cannon</h1>
        <p>Prepare for battle...</p>
        <div id="loading-bar">
            <div id="loading-progress"></div>
        </div>
        <p id="loading-tip">üí° Tip: Press SPACE to dodge with invincibility frames!</p>
    </div>

    <div id="fatal-error-overlay" class="hidden">
        <div class="fatal-error-content">
            <h2>Systems Offline</h2>
            <p id="fatal-error-message">An unexpected error occurred.</p>
            <button id="fatal-error-restart" class="menu-button">Restart Game</button>
        </div>
    </div>

    <!-- Main Menu: Title / Mode Selection -->
    <div id="main-menu" class="hidden">
        <canvas id="menu-background"></canvas>
        <div id="menu-content">
            <h1 id="menu-title">
                <div class="title-line-1">
                    <span class="title-galactic">GALACTIC</span>
                    <span class="title-ring">RING</span>
                </div>
                <span class="title-cannon">CANNON</span>
            </h1>
            <div id="star-menu-display">‚≠ê 0</div>
            <div id="loadout-selector">
                <p id="loadout-selector-title">CHOOSE YOUR PILOT</p>
                <div id="character-options"></div>
                <div id="loadout-description"></div>
            </div>
            <p id="menu-subtitle">SELECT YOUR MODE</p>
            <div id="menu-buttons">
                <button id="btn-normal" class="menu-button menu-button-primary">
                    <span class="button-icon">‚ñ∂</span>
                    <span class="button-text">Normal Mode</span>
                </button>
                <button id="btn-settings" class="menu-button">
                    <span class="button-icon">‚öô</span>
                    <span class="button-text">Settings</span>
                </button>
                <button id="btn-shop" class="menu-button">
                    <span class="button-icon">‚≠ê</span>
                    <span class="button-text">Star Vendor</span>
                </button>
                <button id="btn-achievements" class="menu-button">
                    <span class="button-icon">üèÜ</span>
                    <span class="button-text">Achievements</span>
                </button>
            </div>
        </div>
    </div>

    <div id="game-container" class="hidden">
        <canvas id="game-canvas"></canvas>
        <div id="level-up-container" class="hidden">
            <h2>Level Up!</h2>
            <p class="shortcut-hint">Press 1, 2, or 3 to select an upgrade</p>
            <p class="shortcut-hint secondary-hint">üí° Tip: Press G to toggle Auto-Level mode</p>
            <div id="upgrade-options"></div>
        </div>
        <!-- Timer display at top center -->
        <div id="timer-container">
            <div id="timer-display">00:00</div>
            <div id="boss-countdown" class="hidden">
                <div id="boss-countdown-container">
                    <div id="boss-countdown-bar"></div>
                </div>
            </div>
        </div>

        <div id="ui-container">
            <div id="health-bar"></div>
            <div id="xp-bar"></div>
            <div id="level-display">Level: 1</div>
            <!-- Combo progress bar -->
            <div id="combo-container">
                <div id="combo-fill"></div>
            </div>
            <!-- Combo count display -->
            <div id="combo-text">0</div>
        </div>
        <button id="pause-button" class="control-button">‚è∏Ô∏è</button>
        <div id="controls-info">
            <div class="control-row"><span class="control-key">P</span> / <span class="control-key">ESC</span> Pause
            </div>
            <div class="control-row"><span class="control-key">SPACE</span> Dodge</div>
            <div class="control-row"><span class="control-key">M</span> Audio</div>
            <div class="control-row"><span class="control-key">G</span> Auto-Level</div>
        </div>

        <!-- Add minimap -->
        <div id="minimap-container">
            <canvas id="minimap"></canvas>
        </div>

        <!-- Add skill cooldown indicator -->
        <div id="skill-container">
            <div id="dodge-skill" class="skill">
                <div class="skill-icon">üí®</div>
                <div class="skill-cooldown"></div>
                <div class="skill-key">SPACE</div>
            </div>
        </div>
    </div>

    <div id="pause-menu" class="hidden">
        <div class="pause-content">
            <h2>Game Paused</h2>
            <button id="resume-button" class="menu-button">Resume</button>
            <button id="restart-button-pause" class="menu-button">Restart</button>
            <button id="return-button-pause" class="menu-button">Main Menu</button>
            <h3>Controls:</h3>
            <p>WASD or Arrow Keys = Move</p>
            <p>SPACE = Dodge (dash with invincibility)</p>
            <p>P or ESC = Pause Game</p>
            <p>M = Toggle Sound</p>
            <p>L = Toggle Low Quality</p>
            <p>G = Toggle Auto-Level (automatic upgrades)</p>
            <div class="pause-tips">
                <h3>üí° Tips:</h3>
                <p>‚Ä¢ Numbers 1-3 select upgrades during level-up</p>
                <p>‚Ä¢ Dodge through enemies and projectiles</p>
                <p>‚Ä¢ Minimap shows enemies (red) and XP orbs (green)</p>
            </div>
        </div>
    </div>

    <div id="result-screen" class="hidden">
        <div class="settings-content">
            <h2 id="result-title">Run Complete</h2>
            <p id="result-subtitle"></p>
            <div id="result-stats"></div>
            <div id="result-buttons" class="result-buttons"></div>
        </div>
    </div>

    <!-- Shop Panel -->
    <div id="shop-panel" class="hidden">
        <canvas id="shop-background"></canvas>
        <div id="shop-content">
            <h2>Star Vendor</h2>
            <!-- Show current star balance -->
            <div id="vendor-star-display">‚≠ê 0</div>
            <!-- Pagination controls for shop -->
            <div class="pagination-controls">
                <button id="shop-prev-page" class="page-nav-btn" disabled>‚óÄ</button>
                <div id="shop-page-indicator" class="page-indicator">Page 1 of 1</div>
                <button id="shop-next-page" class="page-nav-btn" disabled>‚ñ∂</button>
            </div>
            <!-- List of purchasable upgrades -->
            <div id="shop-items"></div>
            <button id="shop-close" class="menu-button">Close</button>
        </div>
    </div>
    <!-- Settings Panel -->
    <div id="settings-panel" class="hidden">
        <canvas id="settings-background"></canvas>
        <div id="settings-content">
            <h2>Settings</h2>
            <div class="settings-grid">
                <div class="setting-item">
                    <label for="mute-checkbox">Mute</label>
                    <input type="checkbox" id="mute-checkbox">
                </div>
                <div class="setting-item">
                    <label for="volume-range">Volume</label>
                    <input type="range" id="volume-range" min="0" max="1" step="0.01">
                </div>
                <div class="setting-item">
                    <label for="lowquality-checkbox">Low Quality</label>
                    <input type="checkbox" id="lowquality-checkbox">
                </div>
                <div class="setting-item">
                    <label for="difficulty-select">Difficulty</label>
                    <select id="difficulty-select">
                        <option value="easy">Easy</option>
                        <option value="normal">Normal</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
            </div>
            <button id="settings-close" class="menu-button">Apply & Close</button>
        </div>
    </div>

    <!-- Add Achievements Panel -->
    <div id="achievements-panel" class="hidden">
        <canvas id="achievements-background"></canvas>
        <div id="achievements-content">
            <h2>Achievements</h2>
            <div id="achievements-layout">
                <div id="achievements-sidebar">
                    <button class="category-btn active" data-category="All">All</button>
                    <button class="category-btn" data-category="Combat">Combat</button>
                    <button class="category-btn" data-category="Progression">Progression</button>
                    <button class="category-btn" data-category="Skill">Skill</button>
                    <button class="category-btn" data-category="Special">Special</button>
                </div>
                <div id="achievements-main">
                    <div id="achievements-progress">
                        <span id="achievements-count">0/0</span> Unlocked
                    </div>
                    <div id="achievements-list"></div>
                    <!-- Pagination controls for achievements -->
                    <div class="pagination-controls">
                        <button id="achievements-prev-page" class="page-nav-btn" disabled>‚óÄ</button>
                        <div id="achievements-page-indicator" class="page-indicator">Page 1 of 1</div>
                        <button id="achievements-next-page" class="page-nav-btn" disabled>‚ñ∂</button>
                    </div>
                </div>
            </div>
            <button id="achievements-close" class="menu-button">Close</button>
        </div>
    </div>

    <!-- Configuration files - load FIRST before systems that depend on them -->
    <script defer src="src/config/upgrades.config.js"></script>
    <script defer src="src/config/achievements.config.js"></script>
    <script defer src="src/config/metaUpgrades.config.js"></script>
    <script defer src="src/config/characters.config.js"></script>
    <script defer src="src/config/weapons.config.js"></script>

    <!-- Configuration and utilities - load in proper order -->
    <script defer src="src/utils/Logger.js"></script>
    <!-- LoggerUtils.js REMOVED - Unified into Logger.js -->
    <script src="src/utils/StorageManager.js"></script>
    <script defer src="src/utils/URLParams.js"></script>
    <!-- Legacy MathUtils/CollisionUtils removed; FastMath/CollisionCache replace hot paths -->
    <script defer src="src/utils/TrigCache.js"></script>
    <script defer src="src/utils/FastMath.js"></script>
    <script defer src="src/utils/PerformanceCache.js"></script>
    <script defer src="src/utils/CollisionCache.js"></script>
    <script defer src="src/utils/PerformanceProfiler.js"></script>
    <script defer src="src/utils/GPUMemoryManager.js"></script>
    <script defer src="src/systems/OptimizedParticlePool.js"></script>
    <script defer src="src/systems/InputManager.js"></script>
    <script defer src="src/utils/ParticleHelpers.js"></script>
    <script defer src="src/systems/audio.js"></script>
    <script defer src="src/systems/performance.js"></script>
    <script defer src="src/systems/EnemySpawner.js"></script>
    <!-- Cosmic Background System -->
    <script defer src="src/systems/CosmicBackground.js"></script>
    <script defer src="src/utils/debug.js"></script>
    <script defer src="src/ui/loadDebugProjectiles.js"></script>
    <!-- Dev utilities moved to conditional loader above -->

    <!-- Add error detection for script loading -->
    <script defer src="src/ui/scriptErrorHandler.js"></script>

    <script defer src="src/ui/resultScreen.js"></script>
    <script defer src="src/ui/hudEventHandlers.js"></script>
    <!-- Main Menu - Modular Architecture -->
    <!-- Load base classes first -->
    <script defer src="src/ui/mainMenu/shared/PanelBase.js"></script>
    <script defer src="src/ui/mainMenu/MenuBackgroundRenderer.js"></script>
    <!-- Load specialized panels -->
    <script defer src="src/ui/mainMenu/SettingsPanel.js"></script>
    <script defer src="src/ui/mainMenu/ShopPanel.js"></script>
    <script defer src="src/ui/mainMenu/AchievementsPanel.js"></script>
    <script defer src="src/ui/mainMenu/CharacterSelector.js"></script>
    <!-- Load orchestrator last -->
    <script defer src="src/ui/mainMenu/MainMenuController.js"></script>
    <!-- Core entities - load synchronously to ensure proper initialization order -->
    <script defer src="src/entities/particle.js"></script>
    <script defer src="src/entities/ShockwaveParticle.js"></script>
    <!-- Projectile system - modular behavior-based architecture -->
    <script defer src="src/entities/projectile/behaviors/BehaviorBase.js"></script>
    <script defer src="src/entities/projectile/behaviors/BehaviorManager.js"></script>
    <script defer src="src/entities/projectile/behaviors/PiercingBehavior.js"></script>
    <script defer src="src/entities/projectile/behaviors/RicochetBehavior.js"></script>
    <script defer src="src/entities/projectile/behaviors/ExplosiveBehavior.js"></script>
    <script defer src="src/entities/projectile/behaviors/ChainBehavior.js"></script>
    <script defer src="src/entities/projectile/behaviors/HomingBehavior.js"></script>
    <script defer src="src/entities/projectile/behaviors/BurnBehavior.js"></script>
    <script defer src="src/entities/projectile/ProjectileRenderer.js"></script>
    <script defer src="src/entities/projectile/Projectile.js"></script>
    <script defer src="src/entities/projectile/ProjectilePool.js"></script>
    <script defer src="src/entities/projectile/ProjectileFactory.js"></script>
    <script defer src="src/entities/damageZone.js"></script>
    <script defer src="src/entities/GravityWell.js"></script>
    <script defer src="src/entities/EnemyProjectile.js"></script>
    <script defer src="src/entities/XPOrb.js"></script>
    <!-- Enemy components - shared behavior systems -->
    <script defer src="src/entities/components/EnemyAI.js"></script>
    <script defer src="src/entities/components/EnemyAbilities.js"></script>
    <script defer src="src/entities/components/EnemyMovement.js"></script>
    <script defer src="src/entities/enemy/components/StatusEffectManager.js"></script>
    <!-- Enemy system - modular type-based architecture -->
    <script defer src="src/entities/enemy/types/EnemyTypeBase.js"></script>
    <script defer src="src/entities/enemy/types/BasicEnemy.js"></script>
    <script defer src="src/entities/enemy/types/FastEnemy.js"></script>
    <script defer src="src/entities/enemy/types/TankEnemy.js"></script>
    <script defer src="src/entities/enemy/types/RangedEnemy.js"></script>
    <script defer src="src/entities/enemy/types/DasherEnemy.js"></script>
    <script defer src="src/entities/enemy/types/ExploderEnemy.js"></script>
    <script defer src="src/entities/enemy/types/SplitterEnemy.js"></script>
    <script defer src="src/entities/enemy/types/HealerEnemy.js"></script>
    <script defer src="src/entities/enemy/types/TeleporterEnemy.js"></script>
    <script defer src="src/entities/enemy/types/PhantomEnemy.js"></script>
    <script defer src="src/entities/enemy/types/ShielderEnemy.js"></script>
    <script defer src="src/entities/enemy/types/SummonerEnemy.js"></script>
    <script defer src="src/entities/enemy/types/BerserkerEnemy.js"></script>
    <script defer src="src/entities/enemy/types/MinionEnemy.js"></script>
    <script defer src="src/entities/enemy/types/BossEnemy.js"></script>
    <script defer src="src/entities/enemy/EnemyTypeRegistry.js"></script>
    <script defer src="src/entities/enemy/EnemyStats.js"></script>
    <script defer src="src/entities/enemy/EnemyRenderer.js"></script>
    <script defer src="src/entities/enemy/Enemy.js"></script>
    <!-- Player modular components -->
    <script defer src="src/weapons/WeaponManager.js"></script>
    <script defer src="src/weapons/types/PulseCannon.js"></script>
    <script defer src="src/weapons/types/NovaShotgun.js"></script>
    <script defer src="src/weapons/types/ArcBurst.js"></script>
    <script defer src="src/weapons/types/ConstellationArray.js"></script>
    <script defer src="src/weapons/types/MagmaLauncher.js"></script>
    <script defer src="src/weapons/types/SanguineLance.js"></script>
    <script defer src="src/weapons/types/SingularityCannon.js"></script>
    <script defer src="src/weapons/types/PhantomRepeater.js"></script>
    <script defer src="src/weapons/types/PlasmaCutter.js"></script>
    <script defer src="src/entities/player/PlayerStats.js"></script>
    <script defer src="src/entities/player/PlayerMovement.js"></script>
    <script defer src="src/entities/player/PlayerCombat.js"></script>
    <script defer src="src/entities/player/PlayerAbilities.js"></script>
    <script defer src="src/entities/player/PlayerRenderer.js"></script>
    <!-- Player coordinator class -->
    <script defer src="src/entities/player/Player.js"></script>
    <script defer src="src/systems/upgrades.js"></script>
    <script defer src="src/systems/achievements.js"></script>
    <!-- üåä GAME STATE - Single Source of Truth (load first!) -->
    <script defer src="src/core/GameState.js"></script>
    <script defer src="src/core/systems/CollisionSystem.js"></script>
    <script defer src="src/core/systems/EntityManager.js"></script>
    <script defer src="src/core/systems/StatsManager.js"></script>
    <script defer src="src/core/systems/DifficultyManager.js"></script>
    <script defer src="src/core/systems/UnifiedUIManager.js"></script>
    <script defer src="src/core/systems/MinimapSystem.js"></script>
    <script src="src/core/systems/PerformanceManager.js" defer></script>
    <script defer src="src/core/gameEngine.js"></script>
    <script defer src="src/core/systems/EffectsManager.js"></script>
    <script defer src="src/core/systems/FloatingTextSystem.js"></script>

    <!-- Script loading validation -->
    <script defer src="src/core/setupGlobals.js"></script>

    <!-- Load game constants first -->
    <script defer src="src/config/gameConstants.js"></script>

    <!-- Initialize optimized particle pool -->
    <script defer src="src/core/initOptimizedParticles.js"></script>

    <!-- Load GameManager Bridge only (GameManager class not required at runtime) -->
    <script defer src="src/core/gameManagerBridge.js"></script>

    <script defer src="src/core/bootstrap.js"></script>
</body>

</html>