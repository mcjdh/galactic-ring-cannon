<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A 2D survival game">
    <meta name="author" content="mcjdh">
    <meta name="theme-color" content="#111111">
    <title>Galactic Ring:Cannon</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéÆ</text></svg>">
    
    <!-- Check for ES6 module support -->
    <script>
        window.supportsModules = 'noModule' in HTMLScriptElement.prototype;
        if (window.supportsModules) {
            console.log('‚úÖ ES6 modules supported - using modern version');
        } else {
            console.log('‚ö†Ô∏è ES6 modules not supported - using legacy version');
        }
    </script>
</head>
<body>
    <div id="loading-screen">
        <h1>Galactic Ring:Cannon</h1>
        <p>Prepare for battle...</p>
        <div id="loading-bar">
            <div id="loading-progress"></div>
        </div>
        <p id="loading-tip">Tip: Use WASD or Arrow Keys to move</p>
    </div>
    
    <!-- Main Menu: Title / Mode Selection -->
    <div id="main-menu" class="hidden">
        <h1 id="menu-title">Galactic Ring: Cannon</h1>
        <div id="star-menu-display">‚≠ê 0</div>
        <p id="menu-subtitle">Select Mode:</p>
        <button id="btn-normal" class="menu-button">Normal Mode</button>
        <button id="btn-endless" class="menu-button">Endless Mode</button>
        <button id="btn-settings" class="menu-button">Settings</button>
        <button id="btn-shop" class="menu-button">Star Vendor</button>
        <button id="btn-achievements" class="menu-button">Achievements</button>
    </div>
    
    <div id="game-container" class="hidden">
        <canvas id="game-canvas"></canvas>
        <div id="level-up-container" class="hidden">
            <h2>Level Up!</h2>
            <p class="shortcut-hint">Press 1, 2, or 3 to select an upgrade</p>
            <div id="upgrade-options"></div>
        </div>
        <div id="ui-container">
            <div id="health-bar"></div>
            <div id="xp-bar"></div>
            <div id="level-display">Level: 1</div>
            <!-- Combo progress bar -->
            <div id="combo-container">
                <div id="combo-fill"></div>
            </div>
            <!-- Combo count display -->
            <div id="combo-text">0</div>
        </div>
        <button id="pause-button" class="control-button">‚è∏Ô∏è</button>
        <div id="controls-info">P or ESC = Pause | SPACE = Dodge</div>
        
        <!-- Add minimap -->
        <div id="minimap-container">
            <canvas id="minimap"></canvas>
        </div>
        
        <!-- Add skill cooldown indicator -->
        <div id="skill-container">
            <div id="dodge-skill" class="skill">
                <div class="skill-icon">üí®</div>
                <div class="skill-cooldown"></div>
                <div class="skill-key">SPACE</div>
            </div>
        </div>
    </div>
    
    <div id="pause-menu" class="hidden">
        <div class="pause-content">
            <h2>Game Paused</h2>
        <button id="resume-button" class="menu-button">Resume</button>
        <button id="restart-button-pause" class="menu-button">Restart</button>
        <button id="return-button-pause" class="menu-button">Main Menu</button>
            <h3>Controls:</h3>
            <p>WASD or Arrow Keys = Move</p>
            <p>P or ESC = Pause Game</p>
        <p>M = Toggle Sound</p>
        <p>L = Toggle Low Quality</p>
        </div>
    </div>
    
    <!-- Shop Panel -->
    <div id="shop-panel" class="hidden">
        <div class="settings-content">
            <h2>Star Vendor</h2>
            <!-- Show current star balance -->
            <div id="vendor-star-display">‚≠ê 0</div>
            <!-- List of purchasable upgrades -->
            <div id="shop-items"></div>
            <button id="shop-close" class="menu-button">Close</button>
        </div>
    </div>
    <!-- Settings Panel -->
    <div id="settings-panel" class="hidden">
        <div class="settings-content">
            <h2>Settings</h2>
            <div class="setting-item">
                <label for="mute-checkbox">Mute</label>
                <input type="checkbox" id="mute-checkbox">
            </div>
            <div class="setting-item">
                <label for="volume-range">Volume</label>
                <input type="range" id="volume-range" min="0" max="1" step="0.01">
            </div>
            <div class="setting-item">
                <label for="lowquality-checkbox">Low Quality</label>
                <input type="checkbox" id="lowquality-checkbox">
            </div>
            <div class="setting-item">
                <label for="difficulty-select">Difficulty</label>
                <select id="difficulty-select">
                    <option value="easy">Easy</option>
                    <option value="normal">Normal</option>
                    <option value="hard">Hard</option>
                </select>
            </div>
            <button id="settings-close" class="menu-button">Apply & Close</button>
        </div>
    </div>
    
    <!-- Add Achievements Panel -->
    <div id="achievements-panel" class="hidden">
        <div class="settings-content">
            <h2>Achievements</h2>
            <div id="achievements-progress">
                <span id="achievements-count">0/0</span> Achievements Unlocked
            </div>
            <div id="achievements-list"></div>
            <button id="achievements-close" class="menu-button">Close</button>
        </div>
    </div>
    
    <!-- Modern ES6 Module Version (for supported browsers) -->
    <script type="module">
        console.log('üöÄ Loading modern ES6 module version...');
        import { initializeGame } from './src/main.mjs';
        initializeGame();
    </script>
    
    <!-- Legacy Version (fallback for older browsers) -->
    <script nomodule>
        console.log('‚ö†Ô∏è Loading legacy version for older browsers...');
        
        // Load all scripts in order
        const legacyScripts = [
            'src/systems/audio.js',
            'src/systems/performance.js',
            'src/utils/debug.js',
            'src/entities/particle.js',
            'src/entities/projectile.js',
            'src/entities/damageZone.js',
            'src/entities/enemy.js',
            'src/entities/player.js',
            'src/systems/upgrades.js',
            'src/systems/achievements.js',
            'src/core/gameEngine.js',
            'src/core/gameManager.js',
            'src/ui/uiEnhancements.js'
        ];
        
        let loadedCount = 0;
        
        function loadNextScript() {
            if (loadedCount < legacyScripts.length) {
                const script = document.createElement('script');
                script.src = legacyScripts[loadedCount];
                script.onload = () => {
                    loadedCount++;
                    loadNextScript();
                };
                script.onerror = () => {
                    console.error('Failed to load:', legacyScripts[loadedCount]);
                    loadedCount++;
                    loadNextScript();
                };
                document.head.appendChild(script);
            } else {
                // Initialize legacy game
                initializeLegacyGame();
            }
        }
        
        function initializeLegacyGame() {
            // Initialize UI enhancements
            const uiEnhancements = new UIEnhancements();
            
            // Initialize achievements system
            const achievementSystem = new AchievementSystem();
            
            // Game tips and loading logic (same as before)
            const tips = [
                "Use WASD or Arrow Keys to move",
                "Enemies drop XP orbs when defeated",
                "Collect XP to level up and choose upgrades",
                "Press SPACE to dodge incoming enemies",
                "Bosses appear every 3 minutes",
                "Watch out for explosive enemies!",
                "Ranged enemies will shoot projectiles at you",
                "The game gets harder over time",
                "Piercing projectiles can hit multiple enemies",
                "Press P or ESC to pause the game",
                "The minimap shows nearby enemies and XP orbs"
            ];
            
            // Initialize the rest of the legacy game logic...
            // (This would include all the existing menu handlers, etc.)
            console.log('‚úÖ Legacy game initialized');
        }
        
        loadNextScript();
    </script>
    
    <div id="version-info" style="position: fixed; bottom: 10px; right: 10px; font-size: 12px; color: #666;">
        <span id="version-type">Detecting...</span>
    </div>
    
    <script>
        // Update version display
        setTimeout(() => {
            const versionElement = document.getElementById('version-type');
            if (versionElement) {
                versionElement.textContent = window.supportsModules ? 'ES6 Modules' : 'Legacy';
            }
        }, 100);
    </script>
</body>
</html>
